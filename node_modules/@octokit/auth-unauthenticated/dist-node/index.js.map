{"version":3,"file":"index.js","sources":["../dist-src/auth.js","../dist-src/is-rate-limit-error.js","../dist-src/is-abuse-limit-error.js","../dist-src/hook.js","../dist-src/index.js"],"sourcesContent":["export async function auth(reason) {\n    return {\n        type: \"unauthenticated\",\n        reason,\n    };\n}\n","export function isRateLimitError(error) {\n    if (error.status !== 403) {\n        return false;\n    }\n    /* istanbul ignore if */\n    if (!error.headers) {\n        return false;\n    }\n    return error.headers[\"x-ratelimit-remaining\"] === \"0\";\n}\n","const REGEX_ABUSE_LIMIT_MESSAGE = /\\babuse\\b/i;\nexport function isAbuseLimitError(error) {\n    if (error.status !== 403) {\n        return false;\n    }\n    return REGEX_ABUSE_LIMIT_MESSAGE.test(error.message);\n}\n","import { RequestError } from \"@octokit/request-error\";\nimport { isRateLimitError } from \"./is-rate-limit-error\";\nimport { isAbuseLimitError } from \"./is-abuse-limit-error\";\nconst MUTATING_METHODS = [\"DELETE\", \"PATCH\", \"POST\", \"PUT\"];\nexport async function hook(reason, request, route, parameters) {\n    const endpoint = request.endpoint.merge(route, parameters);\n    if (MUTATING_METHODS.includes(endpoint.method)) {\n        throw new RequestError(`\"${endpoint.method} ${endpoint.url}\" is not permitted due to lack authentication. Reason: ${reason}`, 403, {\n            request: request.endpoint.parse(endpoint),\n        });\n    }\n    return request(endpoint).catch((error) => {\n        if (error.status === 404) {\n            error.message = `Not found. May be due to lack of authentication. Reason: ${reason}`;\n        }\n        if (isRateLimitError(error)) {\n            error.message = `API rate limit exceeded. This maybe caused by the lack of authentication. Reason: ${reason}`;\n        }\n        if (isAbuseLimitError(error)) {\n            error.message = `You have triggered an abuse detection mechanism. This maybe caused by the lack of authentication. Reason: ${reason}`;\n        }\n        throw error;\n    });\n}\n","import { auth } from \"./auth\";\nimport { hook } from \"./hook\";\nexport const createUnauthenticatedAuth = function createUnauthenticatedAuth(options) {\n    if (!options || !options.reason) {\n        throw new Error(\"[@octokit/auth-unauthenticated] No reason passed to createUnauthenticatedAuth\");\n    }\n    return Object.assign(auth.bind(null, options.reason), {\n        hook: hook.bind(null, options.reason),\n    });\n};\n"],"names":["auth","reason","type","isRateLimitError","error","status","headers","REGEX_ABUSE_LIMIT_MESSAGE","isAbuseLimitError","test","message","MUTATING_METHODS","hook","request","route","parameters","endpoint","merge","includes","method","RequestError","url","parse","catch","createUnauthenticatedAuth","options","Error","Object","assign","bind"],"mappings":";;;;;;AAAO,eAAeA,IAAf,CAAoBC,MAApB,EAA4B;AAC/B,SAAO;AACHC,IAAAA,IAAI,EAAE,iBADH;AAEHD,IAAAA;AAFG,GAAP;AAIH;;ACLM,SAASE,gBAAT,CAA0BC,KAA1B,EAAiC;AACpC,MAAIA,KAAK,CAACC,MAAN,KAAiB,GAArB,EAA0B;AACtB,WAAO,KAAP;AACH;AACD;;;AACA,MAAI,CAACD,KAAK,CAACE,OAAX,EAAoB;AAChB,WAAO,KAAP;AACH;;AACD,SAAOF,KAAK,CAACE,OAAN,CAAc,uBAAd,MAA2C,GAAlD;AACH;;ACTD,MAAMC,yBAAyB,GAAG,YAAlC;AACA,AAAO,SAASC,iBAAT,CAA2BJ,KAA3B,EAAkC;AACrC,MAAIA,KAAK,CAACC,MAAN,KAAiB,GAArB,EAA0B;AACtB,WAAO,KAAP;AACH;;AACD,SAAOE,yBAAyB,CAACE,IAA1B,CAA+BL,KAAK,CAACM,OAArC,CAAP;AACH;;ACHD,MAAMC,gBAAgB,GAAG,CAAC,QAAD,EAAW,OAAX,EAAoB,MAApB,EAA4B,KAA5B,CAAzB;AACA,AAAO,eAAeC,IAAf,CAAoBX,MAApB,EAA4BY,OAA5B,EAAqCC,KAArC,EAA4CC,UAA5C,EAAwD;AAC3D,QAAMC,QAAQ,GAAGH,OAAO,CAACG,QAAR,CAAiBC,KAAjB,CAAuBH,KAAvB,EAA8BC,UAA9B,CAAjB;;AACA,MAAIJ,gBAAgB,CAACO,QAAjB,CAA0BF,QAAQ,CAACG,MAAnC,CAAJ,EAAgD;AAC5C,UAAM,IAAIC,yBAAJ,CAAkB,IAAGJ,QAAQ,CAACG,MAAO,IAAGH,QAAQ,CAACK,GAAI,0DAAyDpB,MAAO,EAArH,EAAwH,GAAxH,EAA6H;AAC/HY,MAAAA,OAAO,EAAEA,OAAO,CAACG,QAAR,CAAiBM,KAAjB,CAAuBN,QAAvB;AADsH,KAA7H,CAAN;AAGH;;AACD,SAAOH,OAAO,CAACG,QAAD,CAAP,CAAkBO,KAAlB,CAAyBnB,KAAD,IAAW;AACtC,QAAIA,KAAK,CAACC,MAAN,KAAiB,GAArB,EAA0B;AACtBD,MAAAA,KAAK,CAACM,OAAN,GAAiB,4DAA2DT,MAAO,EAAnF;AACH;;AACD,QAAIE,gBAAgB,CAACC,KAAD,CAApB,EAA6B;AACzBA,MAAAA,KAAK,CAACM,OAAN,GAAiB,qFAAoFT,MAAO,EAA5G;AACH;;AACD,QAAIO,iBAAiB,CAACJ,KAAD,CAArB,EAA8B;AAC1BA,MAAAA,KAAK,CAACM,OAAN,GAAiB,6GAA4GT,MAAO,EAApI;AACH;;AACD,UAAMG,KAAN;AACH,GAXM,CAAP;AAYH;;MCrBYoB,yBAAyB,GAAG,SAASA,yBAAT,CAAmCC,OAAnC,EAA4C;AACjF,MAAI,CAACA,OAAD,IAAY,CAACA,OAAO,CAACxB,MAAzB,EAAiC;AAC7B,UAAM,IAAIyB,KAAJ,CAAU,+EAAV,CAAN;AACH;;AACD,SAAOC,MAAM,CAACC,MAAP,CAAc5B,IAAI,CAAC6B,IAAL,CAAU,IAAV,EAAgBJ,OAAO,CAACxB,MAAxB,CAAd,EAA+C;AAClDW,IAAAA,IAAI,EAAEA,IAAI,CAACiB,IAAL,CAAU,IAAV,EAAgBJ,OAAO,CAACxB,MAAxB;AAD4C,GAA/C,CAAP;AAGH,CAPM;;;;"}